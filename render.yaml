services:
  - type: web
    name: traffick-light-django
    env: python
    plan: free
    buildCommand: chmod +x build.sh && ./build.sh
    startCommand: chmod +x start.sh && ./start.sh
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.0
      - key: DJANGO_SETTINGS_MODULE
        value: org.entrypoints.main.settings
      - key: DJANGO_DEBUG
        value: "False"
      - key: DJANGO_MEMORY_DB
        value: "False"
      - key: POSTGRES_HOST
        fromDatabase:
          name: traffick-light-db
          property: host
      - key: POSTGRES_PORT
        fromDatabase:
          name: traffick-light-db
          property: port
      - key: POSTGRES_DB
        fromDatabase:
          name: traffick-light-db
          property: database
      - key: POSTGRES_USER
        fromDatabase:
          name: traffick-light-db
          property: user
      - key: POSTGRES_PASSWORD
        fromDatabase:
          name: traffick-light-db
          property: password
      # Redis настройки
      - key: CHANNELS_REDIS_HOST
        sync: false
      - key: CHANNELS_REDIS_PORT
        sync: false
      - key: CHANNELS_REDIS_PASSWORD
        sync: false
      - key: CHANNELS_REDIS_DB
        value: "0"
      - key: CHANNELS_REDIS_SSL
        value: "True"

      - fromGroup: redis

databases:
  - name: traffick-light-db
    plan: free
    databaseName: org_p1xu
    user: betronic
